<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laporan Stock</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
        }

        h1, h2 {
            text-align: center;
            color: #333;
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .tabs button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 4px;
            margin: 0 5px;
        }

        .tabs button.active {
            background-color: #0056b3;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        form {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        form label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        form input, form select {
            width: calc(100% - 20px);
            padding: 8px 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        form button {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        form button:hover {
            background-color: #218838;
        }

        .preview {
            max-width: 800px;
            margin: 20px auto;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        table thead {
            background-color: #007bff;
            color: white;
        }

        table th, table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        table th {
            background-color: #007bff;
            color: white;
        }

        table tr:hover {
            background-color: #f1f1f1;
        }

        .action-buttons button {
            margin-right: 5px;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .edit-button {
            background-color: #ffc107;
            color: white;
        }

        .edit-button:hover {
            background-color: #e0a800;
        }

        .delete-button {
            background-color: #dc3545;
            color: white;
        }

        .delete-button:hover {
            background-color: #c82333;
        }

        #saveButton, #saveButtonOrderPermintaanBarang, #saveButtonDailyJob, #saveButtonDivisi {
            display: block;
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-align: center;
        }

        #saveButton, #saveButtonOrderPermintaanBarang, #saveButtonDailyJob, #saveButtonDivisi:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>Input Data</h1>
    <div class="tabs">
        <button class="tab-button active" data-tab="divisi">Divisi</button>
        <button class="tab-button" data-tab="dailyJob">Daily Job</button>
        <button class="tab-button" data-tab="orderPermintaanBarang">Order Permintaan Barang</button>
    </div>

    <div id="divisi" class="tab-content active">
        <form id="divisiForm">
            <label for="division">Divisi:</label>
            <select id="division" name="division" required onchange="updateForm()">
                <option value="">-- Pilih Divisi --</option>
                <option value="INDOOR">INDOOR</option>
                <option value="OUTDOOR">OUTDOOR</option>
                <option value="PRODUKSI">PRODUKSI</option>
                <option value="GUDANG">GUDANG</option>
            </select>
            <div id="commonFields">
                <label for="date">Date:</label>
                <input type="date" id="date" name="date">
                <label for="itemName">Nama Barang:</label>
                <div id="itemNameContainer">
                    <select id="itemNameSelect" name="itemName">
                        <!-- Options will be populated based on division selection -->
                    </select>
                    <input type="text" id="itemNameInput" name="itemName" style="display: none;">
                </div>
                <label for="type">Jenis:</label>
                <select id="type" name="type">
                    <option value="Material Masuk">Material Masuk</option>
                    <option value="Material Terpakai">Material Terpakai</option>
                    <option value="Material Reject">Material Reject</option>
                    <option value="Potongan Reject">Potongan Reject</option>
                </select>
                <label for="quantity">Banyaknya:</label>
                <input type="number" id="quantity" name="quantity">
                <label for="notes">Catatan:</label>
                <input type="text" id="notes" name="notes">
            </div>
            <button type="button" onclick="addData('divisi')">Add Data</button>
        </form>
        <div class="preview">
            <table>
                <thead id="tableHeadDivisi">
                    <tr>
                        <th>No</th>
                        <th>Divisi</th>
                        <th>Date</th>
                        <th>Nama Barang</th>
                        <th>Jenis</th>
                        <th>Banyaknya</th>
                        <th>Catatan</th>
                        <th>Edit</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody id="tableBodyDivisi">
                </tbody>
            </table>
        </div>
        <button id="saveButtonDivisi" onclick="saveToGoogleSheets('divisi')">Save to Google Sheets (Divisi)</button>
    </div>

    <div id="dailyJob" class="tab-content">
        <form id="dailyJobForm">
            <label for="activity">Kegiatan:</label>
            <input type="text" id="activity" name="activity">
            <label for="dateDailyJob">Date:</label>
            <input type="date" id="dateDailyJob" name="dateDailyJob">
            <label for="quantityDailyJob">Banyaknya:</label>
            <input type="number" id="quantityDailyJob" name="quantityDailyJob">
            <label for="statusDailyJob">Status Proses:</label>
            <input type="text" id="statusDailyJob" name="statusDailyJob">
            <button type="button" onclick="addData('dailyJob')">Add Data</button>
        </form>
        <div class="preview">
            <table>
                <thead id="tableHeadDailyJob">
                    <tr>
                        <th>No</th>
                        <th>Kegiatan</th>
                        <th>Date</th>
                        <th>Banyaknya</th>
                        <th>Status Proses</th>
                        <th>Edit</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody id="tableBodyDailyJob">
                </tbody>
            </table>
        </div>
        <button id="saveButtonDailyJob" onclick="saveToGoogleSheets('dailyJob')">Save to Google Sheets (Daily Job)</button>
    </div>

    <div id="orderPermintaanBarang" class="tab-content">
        <form id="orderPermintaanBarangForm">
            <label for="divisionOrder">Divisi:</label>
            <select id="divisionOrder" name="divisionOrder" onchange="updateForm()">
                <option value="">-- Pilih Divisi --</option>
                <option value="INDOOR">INDOOR</option>
                <option value="OUTDOOR">OUTDOOR</option>
                <option value="PRODUKSI">PRODUKSI</option>
                <option value="GUDANG">GUDANG</option>
            </select>
            <div id="commonFieldsOrder">
                <label for="dateOrder">Date:</label>
                <input type="date" id="dateOrder" name="dateOrder">
                <label for="itemNameOrder">Nama Barang:</label>
                <div id="itemNameContainerOrder">
                    <select id="itemNameSelectOrder" name="itemNameOrder">
                        <!-- Options will be populated based on division selection -->
                    </select>
                    <input type="text" id="itemNameInputOrder" name="itemNameOrder" style="display: none;">
                </div>
                <label for="quantityOrder">Banyaknya:</label>
                <input type="number" id="quantityOrder" name="quantityOrder">
                <label for="statusOrder">Status Proses:</label>
                <input type="text" id="statusOrder" name="statusOrder">
            </div>
            <button type="button" onclick="addData('orderPermintaanBarang')">Add Data</button>
        </form>
        <div class="preview">
            <table>
                <thead id="tableHeadOrderPermintaanBarang">
                    <tr>
                        <th>No</th>
                        <th>Divisi</th>
                        <th>Date</th>
                        <th>Nama Barang</th>
                        <th>Banyaknya</th>
                        <th>Status Proses</th>
                        <th>Edit</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody id="tableBodyOrderPermintaanBarang">
                </tbody>
            </table>
        </div>
        <button id="saveButtonOrderPermintaanBarang" onclick="saveToGoogleSheets('orderPermintaanBarang')">Save to Google Sheets (Order Permintaan Barang)</button>
    </div>

    <script>
        // Mengubah tab yang aktif
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));

                button.classList.add('active');
                document.getElementById(button.getAttribute('data-tab')).classList.add('active');
            });
        });

        // Menambahkan data ke tabel pratinjau
        let counter = {divisi: 0, dailyJob: 0, orderPermintaanBarang: 0};

        function addData(tab) {
            let formData = {};
            const form = document.getElementById(`${tab}Form`);

            new FormData(form).forEach((value, key) => formData[key] = value);

            counter[tab]++;
            const tableBody = document.getElementById(`tableBody${capitalizeFirstLetter(tab)}`);
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>${counter[tab]}</td>
                ${Object.values(formData).map(value => `<td>${value}</td>`).join('')}
                <td>
                    <div class="action-buttons">
                        <button class="edit-button" onclick="editRow(this, '${tab}')">Edit</button>
                        <button class="delete-button" onclick="deleteRow(this, '${tab}')">Delete</button>
                    </div>
                </td>
            `;
            tableBody.appendChild(newRow);

            form.reset();
        }

        // Mengedit data di tabel pratinjau
        function editRow(button, tab) {
            const row = button.closest('tr');
            const cells = row.querySelectorAll('td:not(:last-child)');
            const form = document.getElementById(`${tab}Form`);

            let index = 0;
            for (let [key, input] of new FormData(form).entries()) {
                input.value = cells[index].innerText;
                index++;
            }

            deleteRow(button, tab);
        }

        // Menghapus data dari tabel pratinjau
        function deleteRow(button, tab) {
            const row = button.closest('tr');
            row.remove();
            counter[tab]--;
            updateRowNumbers(tab);
        }

        // Memperbarui nomor baris setelah penghapusan
        function updateRowNumbers(tab) {
            const rows = document.querySelectorAll(`#tableBody${capitalizeFirstLetter(tab)} tr`);
            rows.forEach((row, index) => {
                row.querySelector('td:first-child').innerText = index + 1;
            });
        }

        // Mengubah divisi dan menampilkan input sesuai divisi
        function updateForm() {
            const division = document.getElementById('division').value;
            const itemNameSelect = document.getElementById('itemNameSelect');
            const itemNameInput = document.getElementById('itemNameInput');

            itemNameSelect.style.display = division === 'INDOOR' ? 'none' : 'block';
            itemNameInput.style.display = division === 'INDOOR' ? 'block' : 'none';

            if (division === 'INDOOR') {
                itemNameSelect.innerHTML = '';
                itemNameInput.setAttribute('required', '');
            } else {
                itemNameSelect.innerHTML = `
                    <option value="Material A">Material A</option>
                    <option value="Material B">Material B</option>
                    <option value="Material C">Material C</option>
                `;
                itemNameInput.removeAttribute('required');
            }
        }

        // Menyimpan data ke Google Sheets
        function saveToGoogleSheets(tab) {
            const tableBody = document.getElementById(`tableBody${capitalizeFirstLetter(tab)}`);
            const data = Array.from(tableBody.rows).map(row => Array.from(row.cells).map(cell => cell.innerText));
            
            const url = "https://script.google.com/macros/s/AKfycbwuzGfh2oGMe-2odVOlwbCr0vsBi65u5Gvkg9-1-R_P_EWgZi1rPEx18dnrmva9vwNDtg/exec";
            const spreadsheetId = "3qDx6oC3TYEkIvHWov73eONrneaK6a";
            
            fetch(url, {
                method: 'POST',
                body: JSON.stringify({ data, spreadsheetId, sheetName: tab }),
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(response => response.json())
              .then(data => {
                if (data.status === 'success') {
                    alert('Data berhasil disimpan ke Google Sheets!');
                } else {
                    alert('Gagal menyimpan data. Coba lagi.');
                }
              }).catch(error => {
                console.error('Error:', error);
                alert('Gagal menyimpan data. Coba lagi.');
            });
        }

        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }
    </script>
</body>
</html>
